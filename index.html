<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Editor</title>
  <style type="text/css" media="screen">
    html, body {
        overflow: hidden;
        margin: 0;
        padding: 0;
        background-color: rgb(25, 25, 25) !important;
        height: 100%;
        width: 100%;
    }

    .tabs-container {
        background: rgb(20, 25, 35);
        border-bottom: 2px solid rgb(45, 50, 60);
        padding: 8px 12px 0 12px;
        display: flex;
        align-items: flex-end;
        gap: 4px;
        overflow-x: auto;
        overflow-y: hidden;
        height: 48px;
    }

    .tabs-container::-webkit-scrollbar {
        height: 4px;
    }

    .tabs-container::-webkit-scrollbar-track {
        background: rgb(20, 25, 35);
    }

    .tabs-container::-webkit-scrollbar-thumb {
        background: rgb(60, 65, 75);
        border-radius: 2px;
    }

    .tab {
        background: rgb(30, 35, 45);
        border: 2px solid rgb(45, 50, 60);
        border-bottom: none;
        border-radius: 8px 8px 0 0;
        padding: 8px 14px;
        display: flex;
        align-items: center;
        gap: 10px;
        cursor: pointer;
        transition: all 0.2s;
        min-width: 100px;
        max-width: 180px;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }

    .tab:hover {
        background: rgb(35, 40, 50);
    }

    .tab.active {
        background: rgb(25, 25, 25);
        border-color: rgb(60, 65, 75);
        border-bottom: 2px solid rgb(25, 25, 25);
        margin-bottom: -2px;
    }

    .tab-title {
        flex: 1;
        font-size: 13px;
        font-weight: 500;
        color: #d4d4d4;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .tab-close {
        background: transparent;
        border: none;
        color: #969696;
        font-size: 18px;
        cursor: pointer;
        padding: 0;
        line-height: 1;
        width: 20px;
        height: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s;
        border-radius: 4px;
    }

    .tab-close:hover {
        background: rgb(60, 65, 75);
        color: #ff6b35;
    }

    .tab-add {
        background: rgb(30, 35, 45);
        border: 2px solid rgb(45, 50, 60);
        border-bottom: none;
        border-radius: 8px 8px 0 0;
        padding: 8px 12px;
        color: #ff6b35;
        font-size: 18px;
        cursor: pointer;
        transition: all 0.2s;
        line-height: 1;
        min-width: 36px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .tab-add:hover {
        background: rgb(40, 45, 55);
        color: #ff8555;
    }

    .editor-container {
        margin: 0;
        position: absolute;
        top: 48px;
        bottom: 0;
        left: 0;
        right: 0;
        background-color: rgb(25, 25, 25) !important;
    }

    .editor-wrapper {
        display: none;
        height: 100%;
        width: 100%;
    }

    .editor-wrapper.active {
        display: block;
    }

    .ace_editor {
        background-color: rgb(25, 25, 25) !important;
    }

    .ace_gutter {
        background-color: rgb(25, 25, 25) !important;
    }
  </style>
</head>
<body>
<div class="tabs-container" id="tabsContainer"></div>
<div class="editor-container" id="editorContainer"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.2/ace.js" type="text/javascript" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.2/ext-language_tools.js" type="text/javascript" charset="utf-8"></script>
<script>
ace.require("ace/ext/language_tools");

let tabs = [];
let activeTabId = null;
let nextTabId = 1;

window.addEventListener('DOMContentLoaded', () => {
    createTab();
});

function createTab() {
    const tabId = nextTabId++;
    
    // Create editor element
    const editorWrapper = document.createElement('div');
    editorWrapper.id = `editor-wrapper-${tabId}`;
    editorWrapper.className = 'editor-wrapper';
    
    const editorElement = document.createElement('pre');
    editorElement.id = `editor-${tabId}`;
    editorElement.style.height = '100%';
    editorElement.textContent = 'print("Flare Has Loaded!")';
    
    editorWrapper.appendChild(editorElement);
    document.getElementById('editorContainer').appendChild(editorWrapper);
    
    // Initialize ACE editor
    const editor = ace.edit(`editor-${tabId}`);
    editor.setTheme("ace/theme/monokai");
    editor.session.setMode("ace/mode/lua");
    editor.setOptions({
        enableBasicAutocompletion: true,
        enableSnippets: true,
        enableLiveAutocompletion: true
    });
    
    const tab = {
        id: tabId,
        editor: editor,
        element: editorWrapper
    };
    
    tabs.push(tab);
    renderTabs();
    switchToTab(tabId);
}

function renderTabs() {
    const tabsContainer = document.getElementById('tabsContainer');
    tabsContainer.innerHTML = '';
    
    tabs.forEach((tab, index) => {
        const tabElement = document.createElement('div');
        tabElement.className = 'tab' + (tab.id === activeTabId ? ' active' : '');
        tabElement.innerHTML = `
            <span class="tab-title">Script ${index + 1}</span>
            <button class="tab-close">Ã—</button>
        `;
        
        tabElement.onclick = (e) => {
            if (!e.target.classList.contains('tab-close')) {
                switchToTab(tab.id);
            }
        };
        
        const closeBtn = tabElement.querySelector('.tab-close');
        closeBtn.onclick = (e) => {
            e.stopPropagation();
            closeTab(tab.id);
        };
        
        tabsContainer.appendChild(tabElement);
    });
    
    const addButton = document.createElement('button');
    addButton.className = 'tab-add';
    addButton.textContent = '+';
    addButton.onclick = createTab;
    tabsContainer.appendChild(addButton);
}

function closeTab(tabId) {
    if (tabs.length === 1) {
        return; // Don't close the last tab
    }
    
    const tabIndex = tabs.findIndex(t => t.id === tabId);
    const tab = tabs[tabIndex];
    
    // Destroy the editor
    tab.editor.destroy();
    tab.element.remove();
    
    tabs.splice(tabIndex, 1);
    
    // If we closed the active tab, switch to another
    if (tabId === activeTabId) {
        const newActiveTab = tabs[Math.max(0, tabIndex - 1)];
        switchToTab(newActiveTab.id);
    }
    
    renderTabs();
}

function switchToTab(tabId) {
    activeTabId = tabId;
    
    // Hide all editors
    tabs.forEach(tab => {
        tab.element.classList.remove('active');
    });
    
    // Show active editor
    const activeTab = tabs.find(t => t.id === tabId);
    if (activeTab) {
        activeTab.element.classList.add('active');
        activeTab.editor.resize();
        activeTab.editor.focus();
    }
    
    renderTabs();
}

// Function to get the active editor (useful for external access)
function getActiveEditor() {
    const activeTab = tabs.find(t => t.id === activeTabId);
    return activeTab ? activeTab.editor : null;
}

// Make editor accessible globally (for C# WebView2 interaction)
window.getActiveEditor = getActiveEditor;
window.editor = getActiveEditor(); // For backward compatibility
</script>
</body>
</html>
